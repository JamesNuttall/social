{% extends "_layouts/cp" %}
{% import "_includes/forms" as forms %}

{% set title = user.email  %}

{% set crumbs = [
    { label: "Social Login"|t, url: url('social') }
] %}

{% set content %}

    <a href="{{ user.cpEditUrl }}"><img width="80" src="{{ user.getThumbUrl(80) }}" /></a>

    <ul>
        <li><strong>{{ "Username:"|t('app') }}</strong> <a href="{{ user.cpEditUrl }}">{{ user.username }}</a></li>
        <li><strong>{{ "Email:"|t('app') }}</strong> {{ user.email }}</li>
    </ul>

    <hr>

    <h2>{{ "Login Accounts"|t('app') }}</h2>

    <div id="nologinaccounts"{% if loginAccounts|length == 0 %} class="hidden"{% endif %}>
        <p>{{ "No login accounts exist yet."|t('app') }}</p>
    </div>

    {% if loginAccounts|length %}

        <table id="loginAccounts" class="data fullwidth">
            <thead>
                <tr>
                    <th>{{ "OAuth Provider"|t('app') }}</th>
                    <th>{{ "Social User ID"|t('app') }}</th>
                </tr>
            </thead>

            {% for account in loginAccounts %}

                {% set user = account.user %}
                {% set oauthProvider = craft.oauth.getProvider(account.providerHandle) %}

                {% if oauthProvider %}
                    <tr data-id="{{ account.id }}" data-name="{{ oauthProvider.name|t('app') }}">
                        <td class="provider">
                            <div class="thumb">
                                <img width="20" src="{{ oauthProvider.getIconUrl() }}" class="social-icon social-{{ oauthProvider.handle }}" />
                            </div>

                            <div class="label">{{ oauthProvider.name }}</div>
                        </td>

                        <td>
                            {{ account.socialUid }}
                        </td>

                        <td class="thin">
                            <a class="icon delete" title="{{ 'Disconnect'|t('app') }}"></a>
                        </td>
                    </tr>
                {% endif %}

            {% endfor %}

        </table>

    {% endif %}


    {% js %}
    var adminTable = new Craft.AdminTable({
        tableSelector: '#loginAccounts',
        noObjectsSelector: '#nologinaccounts',
        deleteAction: 'social/login-accounts/delete-login-account',
        confirmDeleteMessage: '{{ "Are you sure you want to unlink “{name}” login account?"|t('app') }}',
    });
    {% endjs %}

{% endset %}
