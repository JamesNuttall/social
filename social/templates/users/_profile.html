{% extends "_layouts/cp" %}

{% set title = socialUser.socialUid~"@"~socialUser.provider %}

{% includeCssResource "social/css/social.css" %}


{% set crumbs = [
    { label: "Settings"|t, url: url('settings') },
    { label: "Plugins"|t, url: url('settings/plugins') },
    { label: "Social Login"|t, url: url('social') },
    { label: "Users"|t, url: url('social/users') },
] %}

{% set content %}

    <h2>User</h2>

    {% set user = craft.users.id(socialUser.userId).first %}

    <table class="data">
        {% if user.photoUrl %}
            <tr>
                <th>Photo</th>
                <td>
                    <img src="{{ user.photoUrl }}" alt="">
                </td>
            </tr>
        {% endif %}
        <tr>
            <th>Username</th>
            <td>{{ user.username }}</td>
        </tr>
        <tr>
            <th>Email</th>
            <td>
                <a href="mailto:{{ user.email }}">{{ user.email }}</a>
            </td>
        </tr>

        {% if user.fullName %}
            <tr>
                <th>Name</th>
                <td>{{ user.fullName }}</td>
            </tr>
        {% endif %}
    </table>

    <p>
        <a href="{{user.cpEditUrl}}" class="btn small">Edit User</a>
    </p>

    <hr>

    <h2>Social Profile</h2>

    {% set socialProvider = craft.social.getProvider(socialUser.provider) %}

    {{ socialProvider.setToken(socialUser.token) }}

    {% set profile = socialProvider.getProfile() %}

    {% if profile %}
        <table class="data">
            <tr>
                <th>provider</th>
                <td>{{ socialUser.provider }}</td>
            </tr>

            {% for key, value in profile %}
                <tr>
                    <th>{{ key }}</th>
                    <td>
                        {% switch key %}

                            {% case "photo" %}

                                <img src="{{ value }}" height="100" />

                                <br />

                                <a href="{{ actionUrl('social/changePhoto', { userId: socialUser.userId, photoUrl: value }) }}" class="btn small">Use as photo</a>

                            {% case "profileUrl" %}

                                <a href="{{ value }}">{{ value }}</a>

                            {% default %}

                            {{ value }}
                        {% endswitch %}
                    </td>
                </tr>
            {% endfor %}
        </table>
    {% else %}
        <p class="error">Couldn't get profile</p>
    {% endif %}

    <hr>

    <h2>Token</h2>

    {% set token = socialUser.token %}

    {% if token.endOfLife > 0 %}
        {% set remaingSeconds = token.endOfLife - now|date('U') %}
        <p>Token expires in {{ remaingSeconds }} seconds.</p>
    {% else %}
        <p>Token doesn't expire.</p>
    {% endif %}



    <pre>{{ dump(token) }}</pre>

{% endset %}