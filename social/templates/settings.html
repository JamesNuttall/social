{% import "_includes/forms" as forms %}

{% if CraftEdition == CraftPro %}

    {% set oauth = craft.plugins.getPlugin('oauth') %}

    {% if oauth %}

        <h2 class="first">OAuth Providers</h2>

        <p>Set up the OAuth providers that you want to use for social login.</p>

        {% set oneFound = false %}

        {% set providers = craft.social.getProviders(false) %}

        {% if providers|length > 0 %}
            <ul>
                {% for provider in providers %}
                    <li><span class="status {{(provider.isConfigured ? 'on' : '')}}"></span> {{provider.name}}</li>
                {% endfor %}
            </ul>
        {% else %}
            <p>No provider configured</p>
        {% endif %}

        <p><a href="{{url('settings/plugins/oauth')}}" class="btn icon settings">OAuth Settings</a></p>

        <hr>

        <h2>{{ "Login & Registration"|t }}</h2>

        {{ forms.checkboxField({
            label: 'Enable social login ?'|t,
            instructions: "Allow people to social login to an existing account."|t,
            name: 'allowSocialLogin',
            checked:   settings.allowSocialLogin,
            toggle: 'enableSocialLogin'
        }) }}



        <div id="enableSocialLogin"{% if not settings.allowSocialLogin %} class="hidden"{% endif %}>

            {{ forms.checkboxField({
                label: 'Enable social registration ?'|t,
                instructions: "Register new user on Social Login if no existing account is found."|t,
                name: 'allowSocialRegistration',
                checked:   settings.allowSocialRegistration,
                toggle: 'enableSocialRegistration'
            }) }}

            <div id="enableSocialRegistration"{% if not settings.allowSocialRegistration %} class="hidden"{% endif %}>
                <div id="defaultGroup">
                    {% set groups = [{ label: "None"|t, value: '' }] %}
                    {% for group in craft.userGroups.getAllGroups() %}
                        {% set groups = groups|merge([{ label: group.name, value: group.id }]) %}
                    {% endfor %}

                    {{ forms.selectField({
                        label: "Default User Group"|t,
                        instructions: "Choose a user group that socially-registered members will be added to by default."|t,
                        name: 'defaultGroup',
                        options: groups,
                        value: (settings.defaultGroup is defined ? settings.defaultGroup : null)
                    }) }}
                </div>

            </div>

        </div>

    {% else %}

        {% include 'social/_oauth/index' %}

    {% endif %}

{% else %}

    {% includeCssResource 'social/css/disableSave.css' %}

    <h2>{{ "Craft Pro required"|t }}</h2>
    <p>{{ "Social Login plugin requires Craft Pro."|t }}</p>

{% endif %}
